services:
    # ---------------------
    # MySQL Database
    # ---------------------
    wp_db:
        image: mysql:5.7
        restart: always
        environment:
            MYSQL_ROOT_PASSWORD: rootpassword
            MYSQL_DATABASE: wordpress
            MYSQL_USER: wpuser
            MYSQL_PASSWORD: wppassword
        volumes:
            - wp_db_data:/var/lib/mysql

    # ---------------------
    # WordPress
    # ---------------------
    wordpress:
        image: wordpress:php8.1-fpm
        restart: always
        depends_on:
          - wp_db
        environment:
            WORDPRESS_DB_HOST: wp_db:3306
            WORDPRESS_DB_USER: wpuser
            WORDPRESS_DB_PASSWORD: wppassword
            WORDPRESS_DB_NAME: wordpress
        volumes:
            - ./wordpress/wp-content:/var/www/html/wp-content

    # ---------------------
    # Chat API (Node.js)
    # ---------------------
    api:
        build: ./api
        restart: always
        ports:
          - "3001:3001"
        environment:
          PORT: 3001
        depends_on:
          - wordpress

    # ---------------------
    # Nginx Reverse Proxy
    # ---------------------
    nginx:
        image: nginx:latest
        restart: always
        ports:
            - "80:80"
        depends_on:
            - wordpress
            - api
        volumes:
            - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
            - ./wordpress:/var/www/html:ro

volumes:
     wp_db_data:
